{
  "hash": "1f5e96139ed987c2b973dd94fa3a2e82",
  "result": {
    "markdown": "---\ntitle: \"The Art & Science of<br>Data Visualization\"\nsubtitle: \"<span style='font-size:1.5em;'>Engaging and Reproducible Graphics with ggplot2</span><br><span style='font-weight:500;font-size:1.3em;'>Working with Labels and Annotations</span></span>\"\nauthor: \"<b style='color:#28a87d;'><a href='https://www.cedricscherer.com'>Dr. Cédric Scherer</a></b>&ensp;**//**&ensp;RTG-UGI Workshop&ensp;**//**&ensp;October 2023\"\nformat:\n  revealjs:\n    theme: slides.scss\n    logo: img/logo.png\n    footer: '**[Cédric Scherer](https://cedricscherer.com)** // Data Visualization & Information Design'\n    transition: fade\n    progress: true\n    multiplex: false\n    preview-links: true\n    scrollable: false\n    hide-inactive-cursor: true\n    highlight-style: printing\n    chalkboard:\n      theme: whiteboard\n      boardmarker-width: 4\n      buttons: true\n    pause: true\n    mainfont: Asap SemiCondensed\neditor: source\nknitr:\n  opts_chunk:\n    dev: \"ragg_png\"\n    retina: 3\n    dpi: 200\nexecute:\n  freeze: auto\n  cache: true\n  echo: true\n  fig-width: 5\n  fig-height: 6\n---\n\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(stringr)\n\nbikes <- readr::read_csv(\n  here::here(\"data\", \"london-bikes-custom.csv\"),\n  col_types = \"Dcfffilllddddc\"\n)\n\nbikes$season <- forcats::fct_inorder(bikes$season)\n\ntheme_set(theme_light(base_size = 14, base_family = \"Asap SemiCondensed\"))\n\ntheme_update(\n  panel.grid.minor = element_blank(),\n  legend.position = \"top\"\n)\n```\n:::\n\n\n\n\n# Labels + `theme()`\n\n\n\n## Working with Labels\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"9,10,11,12,13,14,15,16,17\"}\ng <- ggplot(\n    bikes,\n    aes(x = temp, y = count,\n        color = season)\n  ) +\n  geom_point(\n    alpha = .5\n  ) +\n  labs(\n    x = \"Temperature (°C)\",\n    y = \"Reported bike shares\",\n    title = \"TfL bike sharing trends\",\n    subtitle = \"Reported bike rents versus temperature in London\",\n    caption = \"Data: TfL\",\n    color = \"Season:\",\n    tag = \"1.\"\n  )\n\ng\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-bundled-extended-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-theme-title_b2fcc445c14ff6a6fd89a864e15e7a4f'}\n\n```{.r .cell-code}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\"\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-theme-title-1.png){width=1000}\n:::\n:::\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-labs-theme-element-text_0e58a272afda3397cb574d3c38bc4a9f'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"#28a87d\"\n  )\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-theme-element-text-1.png){width=1000}\n:::\n:::\n\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-labs-theme-element-text-more_7e9745be50440ddc69c8dbe953581257'}\n\n```{.r .cell-code  code-line-numbers=\"6,7,8|9,10,11,12\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"#28a87d\",\n    family = \"Spline Sans Mono\",\n    face = \"italic\",\n    lineheight = 1.3, # no effect here\n    angle = 45,\n    hjust = 1,\n    vjust = 0,\n    margin = margin(10, 0, 20, 0)\n  )\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-theme-element-text-more-1.png){width=1000}\n:::\n:::\n\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-labs-theme-element-text-no-effect_759542e55f0449e48f916368b2f171e5'}\n\n```{.r .cell-code  code-line-numbers=\"10,11,12\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"#28a87d\",\n    family = \"Spline Sans Mono\",\n    face = \"italic\",\n    lineheight = 1.3, # no effect here\n    angle = 45,\n    hjust = 1, # no effect here\n    vjust = 0, # no effect here\n    margin = margin(10, 0, 20, 0) # no effect here\n  )\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-theme-element-text-no-effect-1.png){width=1000}\n:::\n:::\n\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-labs-theme-element-text-x_7736a128c34ce791f7ec164d4c102356'}\n\n```{.r .cell-code  code-line-numbers=\"14,15,16,17,18\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"#28a87d\",\n    family = \"Spline Sans Mono\",\n    face = \"italic\",\n    lineheight = 1.3, # no effect here\n    angle = 45,\n    hjust = 1, # no effect here\n    vjust = 0, # no effect here\n    margin = margin(10, 0, 20, 0) # no effect here\n  ),\n  axis.text.x = element_text(\n    hjust = 1,\n    vjust = 0,\n    margin = margin(10, 0, 20, 0) # trbl\n  )\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-theme-element-text-x-1.png){width=1000}\n:::\n:::\n\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-labs-theme-element-text-tag_975a3448054fd700c714afdfe88a6de8'}\n\n```{.r .cell-code  code-line-numbers=\"14,15,16\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"#28a87d\",\n    family = \"Spline Sans Mono\",\n    face = \"italic\",\n    lineheight = 1.3, # no effect here\n    angle = 45,\n    hjust = 1, # no effect here\n    vjust = 0, # no effect here\n    margin = margin(10, 0, 20, 0) # no effect here\n  ),\n  plot.tag = element_text(\n    margin = margin(0, 12, -8, 0) # trbl\n  )\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-theme-element-text-tag-1.png){width=1000}\n:::\n:::\n\n\n\n## Customize Labels via \\`theme()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggplot-labs-theme-element-text-debug_7b4a09c15fa657798f74970cee2f2825'}\n\n```{.r .cell-code  code-line-numbers=\"13,17\"}\ng + theme(\n  plot.title = element_text(face = \"bold\"),\n  plot.title.position = \"plot\",\n  axis.text = element_text(\n    color = \"#28a87d\",\n    family = \"Spline Sans Mono\",\n    face = \"italic\",\n    hjust = 1,\n    vjust = 0,\n    angle = 45,\n    lineheight = 1.3, # no effect here\n    margin = margin(10, 0, 20, 0), # no effect here\n    debug = TRUE\n  ),\n  plot.tag = element_text(\n    margin = margin(0, 12, -8, 0), # trbl\n    debug = TRUE\n  )\n)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggplot-labs-theme-element-text-debug-1.png){width=1000}\n:::\n:::\n\n\n\n\n# Labels + `scale_*()`\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-scales-prep_6a2a4ad6d30d98d49544d1dbbfd3feb6'}\n\n```{.r .cell-code  code-line-numbers=\"1,2|4,5,6,7\"}\ng <- g + labs(tag = NULL, title = NULL, \n              subtitle = NULL)\n\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-prep-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-scales-1_4493deb3a8be24dc584d6f880bfd753c'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format()\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-1-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-scales-2_148ae3b541949b7661cc1db9cb53c758'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6|5|7\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format(\n      suffix = \" bikes\"\n    ),\n    name = NULL\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-2-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-scales-3_ed2063fa88543a14f18c3cadfbdad681'}\n\n```{.r .cell-code  code-line-numbers=\"5|9,10,11,12,13\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format(\n      suffix = \"\\nbikes shared\"\n    ),\n    name = NULL\n  ) +\n  theme(\n    axis.text.y = element_text(\n      hjust = .5\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-3-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-scales-4_7e7f50cb32bd80b6dea81d0094fefed9'}\n\n```{.r .cell-code  code-line-numbers=\"5|5,7\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = scales::comma_format(\n      scale = .001\n    ),\n    name = \"Reported bike shares in thousands\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-scales-4-1.png){width=1000}\n:::\n:::\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-function_2dd68b164f6abd541bbda6700ae8e7f6'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\ng +\n  scale_y_continuous(\n    breaks = 0:4*15000,\n    labels = function(y) y / 1000,\n    name = \"Reported bike shares in thousands\",\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-function-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-continuous-labels-function-paste_18cda857168ff4a7c54792102af8fda7'}\n\n```{.r .cell-code  code-line-numbers=\"2,5|3|4\"}\ng +\n  scale_x_continuous(\n    labels = function(y) paste0(y, \"°C\"),\n    name = \"Temperature\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-continuous-labels-function-paste-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-discrete-labels_9f4c1d039a8523afc884198e39c048a7'}\n\n```{.r .cell-code}\nggplot(\n    bikes,\n    aes(x = season, y = count)\n  ) +\n  geom_boxplot() +\n  scale_x_discrete()\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-discrete-labels-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-xy-discrete-labels-function_2be70c01c9611f40ba5abd75f755c45e'}\n\n```{.r .cell-code  code-line-numbers=\"8|7,8\"}\nggplot(\n    bikes,\n    aes(x = season, y = count)\n  ) +\n  geom_boxplot() +\n  scale_x_discrete(\n    name = NULL,\n    labels = stringr::str_to_title\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-xy-discrete-labels-function-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Format Labels via \\`scale\\_\\*\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/scales-color-discrete-name-labels_9abcc98f4dedbe477b1049d1cced1de4'}\n\n```{.r .cell-code  code-line-numbers=\"2,4\"}\ng +\n  scale_color_discrete(\n    name = NULL,\n    labels = stringr::str_to_title\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/scales-color-discrete-name-labels-1.png){width=1000}\n:::\n:::\n\n\n\n\n# Labels +<br>`element_markdown`\n\n\n\n## Styling Labels with {ggtext}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-prep-markdown_d810548bff23f1b039b818024dfc2d1d'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\n# install.packages(\"ggtext\")\n\ng +\n  ggtitle(\"**TfL bike sharing trends by _season_**\")\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-prep-markdown-1.png){width=1000}\n:::\n:::\n\n\n## Styling Labels with {ggtext}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-element-markdown_f45bc7f71d56be5bbf31eb208a791fbb'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6,7|4|6\"}\n# install.packages(\"ggtext\")\n\ng +\n  ggtitle(\"**TfL bike sharing trends by _season_**\") +\n  theme(\n    plot.title = ggtext::element_markdown()\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-element-markdown-1.png){width=1000}\n:::\n:::\n\n\n## Styling Labels with {ggtext}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-element-markdown-html_233ea7008bb74d0068a681674b6d07e6'}\n\n```{.r .cell-code  code-line-numbers=\"4|4,6\"}\n# install.packages(\"ggtext\")\n\ng +\n  ggtitle(\"<b style='font-size:25pt'>TfL</b> bike sharing trends by <i style='color:#28a87d;'>season</i>\") +\n  theme(\n    plot.title = ggtext::element_markdown()\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-element-markdown-html-1.png){width=1000}\n:::\n:::\n\n\n<div style=\"font-size:15pt;\">\n\n`<b style='font-size:15pt;'>TfL</b> bike sharing trends by <i style='color:#28a87d;'>season</i>`\n\n</div>\n\n\n\n# Handling Long Labels\n\n\n\n## Handling Long Labels with {stringr}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/stringr-default-labs_cd543e4e79f5f7c787c1ef2fbfdadabf'}\n\n```{.r .cell-code}\nggplot(\n    bikes,\n    aes(x = weather_type,\n        y = count)\n  ) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/stringr-default-labs-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Handling Long Labels with {stringr}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/stringr-wrap-labs_d6345432cd2e9888e232b715befbad45'}\n\n```{.r .cell-code  code-line-numbers=\"3\"}\nggplot(\n    bikes,\n    aes(x = stringr::str_wrap(weather_type, 6),\n        y = count)\n  ) +\n  geom_boxplot()\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/stringr-wrap-labs-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Handling Long Labels with {ggtext}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-text-default_3d21d167ebb3ddac3c918b3dd56d7082'}\n\n```{.r .cell-code  code-line-numbers=\"2|3,4,5,6|4\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = element_text(size = 20),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-text-default-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Handling Long Titles\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-textbox-default_2e8df59b2eec64d656ddd2474db76db3'}\n\n```{.r .cell-code  code-line-numbers=\"5,6,7\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title =\n      ggtext::element_textbox_simple(\n        size = 20\n      ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-textbox-default-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Handling Long Titles\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-textbox-margin_ea744af151a5ae18442b811b61085246'}\n\n```{.r .cell-code  code-line-numbers=\"6,7\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = \n      ggtext::element_textbox_simple(\n        margin = margin(t = 12, b = 12),\n        lineheight = .9\n      ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-textbox-margin-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Handling Long Titles\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-textbox-box_67d7596075ac0b4163d36e8cbd8c043c'}\n\n```{.r .cell-code  code-line-numbers=\"7\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = \n      ggtext::element_textbox_simple(\n        margin = margin(t = 12, b = 12),\n        fill = \"grey90\",\n        lineheight = .9\n      ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-textbox-box-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Handling Long Titles\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/ggtext-textbox-box-styled_98f469edbfba75eff2b2f3604dda0762'}\n\n```{.r .cell-code  code-line-numbers=\"7|9|10|11|12|13\"}\ng +\n  ggtitle(\"TfL bike sharing trends in 2015 and 2016 by season for day and night periods\") +\n  theme(\n    plot.title = \n      ggtext::element_textbox_simple(\n        margin = margin(t = 12, b = 12),\n        padding = margin(rep(12, 4)),\n        fill = \"grey90\",\n        box.colour = \"grey30\",\n        linetype = \"13\",\n        r = unit(9, \"pt\"),\n        halign = .5,\n        face = \"bold\",\n        lineheight = .9\n      ),\n    plot.title.position = \"plot\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/ggtext-textbox-box-styled-1.png){width=1000}\n:::\n:::\n\n\n\n\n# Annotations &<br>Call-Outs\n\n\n\n## Add Single Text Annotations\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-setup_af3b7e2d6e7e45bcb33507dbd24f89b9'}\n\n```{.r .cell-code  code-line-numbers=\"1|2,3|4,5,6,7|8,9,10,11|5,9\"}\nga <- \n  ggplot(bikes, \n         aes(x = temp, y = count)) +\n  geom_point(\n    aes(color = count > 40000),\n    size = 2\n  ) +\n  scale_color_manual(\n    values = c(\"grey\", \"firebrick\"),\n    guide = \"none\"\n  )\n\nga\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-setup-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Single Text Annotations\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text_07fb81d3e99369a69c0b2beadc8d4175'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4,5,6|2|3,4|5\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 18,\n    y = 48000,\n    label = \"What happened here?\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-1.png){width=1000}\n:::\n:::\n\n\n\n\n\n## Style Text Annotations\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-adj_4d8bcdb5629d27d55d0c5f59ff340615'}\n\n```{.r .cell-code  code-line-numbers=\"7,8,9,10,11\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 18,\n    y = 48000,\n    label = \"What happened here?\",\n    color = \"firebrick\",\n    size = 6,\n    family = \"Asap SemiCondensed\",\n    fontface = \"bold\",\n    lineheight =  .8\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-adj-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Multiple Text Annotations\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-multiple_8c561086b366a9837fb2e0b0f564138a'}\n\n```{.r .cell-code  code-line-numbers=\"4,5,6|4,5,6,7,8,9,10,11\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = c(18, max(bikes$temp)),\n    y = c(48000, 1000),\n    label = c(\"What happened here?\", \"Powered by TfL\"),\n    color = c(\"firebrick\", \"black\"),\n    size = c(6, 3),\n    family = c(\"Asap SemiCondensed\", \"Hepta Slab\"),\n    fontface = c(\"bold\", \"plain\"),\n    hjust = c(.5, 1)\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-multiple-1.png){width=1000}\n:::\n:::\n\n\n\n\n## \"Point'n'Click\" Annotations\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/ggannotate_0582695796c1d76c4d3adc2b7d93a3c5'}\n\n```{.r .cell-code}\nggannotate::ggannotate(g)\n```\n:::\n\n\n![](img/annotations/ggannotate.png){fig-align=\"center\" fig-alt=\"A screenshot of the Shiny app provided by the ggannotate package which allows to place a text annotation by clicking and returns the code.\"}\n\n\n\n## Add Boxes\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-rect_00ef33d7171f65062f2388217b9b0218'}\n\n```{.r .cell-code  code-line-numbers=\"11,18|11,12,18|13,14,15,16|17,18|5,8,15\"}\nga + \n  annotate(\n    geom = \"text\",\n    x = 19.5,\n    y = 42000,\n    label = \"What happened here?\",\n    family = \"Asap SemiCondensed\",\n    size = 6,\n    vjust = 1.3\n  ) +\n  annotate(\n    geom = \"rect\",\n    xmin = 17, \n    xmax = 22,\n    ymin = 42000, \n    ymax = 54000,\n    color = \"firebrick\", \n    fill = NA\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-rect-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Lines\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-line_7a38d208b39e6ccf1ad7296fbfa2201b'}\n\n```{.r .cell-code  code-line-numbers=\"11,17|12|13,14,15,16|4,5,13,15\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 10,\n    y = 38000,\n    label = \"The\\nhighest\\ncount\",\n    family = \"Asap SemiCondensed\",\n    size = 6,\n    lineheight =  .8\n  ) +\n  annotate(\n    geom = \"segment\",\n    x = 13, \n    xend = 18.2,\n    y = 38000, \n    yend = 51870\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-line-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Lines\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-curve_2b6d08116290c6db355ed60ff63afe54'}\n\n```{.r .cell-code  code-line-numbers=\"13,14,15,16|6,11,15\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 10,\n    y = 38000,\n    label = \"The\\nhighest\\ncount\",\n    family = \"Asap SemiCondensed\",\n    size = 6,\n    lineheight =  .8\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 13, \n    xend = 18.2,\n    y = 38000, \n    yend = 51870\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-curve-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Arrows\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-arrow_b505fc96f46c5c266d3c2320ef8829de'}\n\n```{.r .cell-code  code-line-numbers=\"17,18\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 10,\n    y = 38000,\n    label = \"The\\nhighest\\ncount\",\n    family = \"Asap SemiCondensed\",\n    size = 6,\n    lineheight =  .8\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 13, \n    xend = 18.2,\n    y = 38000, \n    yend = 51870,\n    curvature = .25,\n    arrow = arrow()\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-arrow-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Arrows\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-arrow-type2_1ec8a33c36acd423b1c4ad96d924cd78'}\n\n```{.r .cell-code  code-line-numbers=\"18,19,20,21,22|19,20,21\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 10,\n    y = 38000,\n    label = \"The\\nhighest\\ncount\",\n    family = \"Asap SemiCondensed\",\n    size = 6,\n    lineheight =  .8\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 13, \n    xend = 18.2,\n    y = 38000, \n    yend = 51870,\n    curvature = .25,\n    arrow = arrow(\n      length = unit(10, \"pt\"),\n      type = \"closed\",\n      ends = \"both\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-arrow-type2-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Add Arrows\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-text-arrow-skewed_0edd110ba0e7f2306a31816595933b45'}\n\n```{.r .cell-code  code-line-numbers=\"18|19,20,21,22\"}\nga +\n  annotate(\n    geom = \"text\",\n    x = 10,\n    y = 38000,\n    label = \"The\\nhighest\\ncount\",\n    family = \"Asap SemiCondensed\",\n    size = 6,\n    lineheight =  .8\n  ) +\n  annotate(\n    geom = \"curve\",\n    x = 13, \n    xend = 18.2,\n    y = 38000, \n    yend = 51870,\n    curvature = .8,\n    angle = 130,\n    arrow = arrow(\n      length = unit(10, \"pt\"),\n      type = \"closed\"\n    )\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-text-arrow-skewed-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Highlight Hot Days\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-hot-periods_2fda6c08354e06c3fc5957c9ab445b47'}\n\n```{.r .cell-code  code-line-numbers=\"1|2,3,4,5,6|2,3,4,5,6,11|7,8,9,10|5,12,13,14,15\"}\ngh <- \n  ggplot(\n    data = filter(bikes, temp >= 27),\n    aes(x = date, y = temp)\n  ) +\n  geom_point(\n    data = bikes,\n    color = \"grey65\", alpha = .3\n  ) +\n  geom_point(size = 2.5)\n\ngh\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-hot-periods-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with geom_text()\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text_e41b6e076cf5ad64648e2c54ca667175'}\n\n```{.r .cell-code  code-line-numbers=\"2,6|3|4,5\"}\ngh +\n  geom_text(\n    aes(label = format(date, \"%m/%d\")),\n    nudge_x = 10,\n    hjust = 0\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with geom_label()\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-label_8f3a13546aef0849d7e39cbf9879b442'}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\ngh +\n  geom_label(\n    aes(label = format(date, \"%m/%d\")),\n    nudge_x = .3,\n    hjust = 0\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-label-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggrepel}\n\n\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text-repel_308ab9edef68ef0cff17d5f997f8bd35'}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4\"}\ngh +\n  ggrepel::geom_text_repel(\n    aes(label = format(date, \"%m/%d\"))\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-repel-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggrepel}\n\n\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text-repel-styling_c551d67626e7f6e318a4a060c7ba667c'}\n\n```{.r .cell-code  code-line-numbers=\"3|4,5,6\"}\ngh + \n  ggrepel::geom_text_repel(\n    aes(label = format(date, \"%m/%d\")),\n    family = \"Spline Sans Mono\",\n    size = 4.5,\n    fontface = \"bold\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-repel-styling-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text-repel-dist_cf4fa13ab7e31898289a3d4c541c7425'}\n\n```{.r .cell-code  code-line-numbers=\"5,6|7,8\"}\ngh +\n  ggrepel::geom_text_repel(\n    aes(label = format(date, \"%m/%d\")),\n    family = \"Spline Sans Mono\",\n    # space between points + labels\n    box.padding = .8,\n    # always draw segments\n    min.segment.length = 0\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-repel-dist-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text-repel-lim_37e0e691c4500713e98f1167710d6fab'}\n\n```{.r .cell-code  code-line-numbers=\"5,6|5,6,7|3\"}\ngh +\n  ggrepel::geom_text_repel(\n    aes(label = format(date, \"%y/%m/%d\")),\n    family = \"Spline Sans Mono\",\n    # force to the right\n    xlim = c(NA, as.Date(\"2015-06-01\")), \n    hjust = 1\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-repel-lim-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text-repel-arrow_4c750bfc741cd76530bd17dbb1da7a79'}\n\n```{.r .cell-code  code-line-numbers=\"6,7,8\"}\ngh +\n  ggrepel::geom_text_repel(\n    aes(label = format(date, \"%y/%m/%d\")),\n    family = \"Spline Sans Mono\",\n    xlim = c(NA, as.Date(\"2015-06-01\")),\n    # style segment\n    segment.curvature = .01,\n    arrow = arrow(length = unit(.02, \"npc\"), type = \"closed\")\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-repel-arrow-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggrepel}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-text-repel-inflect_3a3e56de3328ec1cb35e0ad1c388169d'}\n\n```{.r .cell-code  code-line-numbers=\"8\"}\ngh +\n  ggrepel::geom_text_repel(\n    aes(label = format(date, \"%y/%m/%d\")),\n    family = \"Spline Sans Mono\",\n    xlim = c(NA, as.Date(\"2015-06-01\")),\n    # style segment\n    segment.curvature = .001,\n    segment.inflect = TRUE\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-text-repel-inflect-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-mark-rect_0b768cc53ddf50c09dc23bb5e2b9ed9d'}\n\n```{.r .cell-code  code-line-numbers=\"2,5|3,4\"}\ng +\n  ggforce::geom_mark_rect(\n    aes(label = \"Outliers?\",\n        filter = count > 40000)\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-mark-rect-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-mark-rect-color_98f5a8698850cbe10299577753cd6f0b'}\n\n```{.r .cell-code  code-line-numbers=\"5,6\"}\ng +\n  ggforce::geom_mark_rect(\n    aes(label = \"Outliers?\",\n        filter = count > 40000),\n    color = \"black\",\n    label.family = \"Asap SemiCondensed\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-mark-rect-color-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-mark-rect-description_075b5a512fbfdacf5e8df614888e7adf'}\n\n```{.r .cell-code  code-line-numbers=\"11,12,13\"}\ng +\n  ggforce::geom_mark_rect(\n    aes(label = \"Outliers?\",\n        filter = count > 40000),\n    description = \"What happened on\\nthese two days?\",\n    color = \"black\",\n    label.family = \"Asap SemiCondensed\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-mark-rect-description-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-mark-rect-modify_2261cd8e5fd1db39d40fc64c56648ba5'}\n\n```{.r .cell-code  code-line-numbers=\"8,9,10,11,12,13\"}\ng +\n  ggforce::geom_mark_rect(\n    aes(label = \"Outliers?\",\n        filter = count > 40000),\n    description = \"What happened on\\nthese two days?\",\n    color = \"black\",\n    label.family = \"Asap SemiCondensed\",\n    expand = unit(8, \"pt\"),\n    radius = unit(12, \"pt\"),\n    con.cap = unit(0, \"pt\"),\n    label.buffer = unit(15, \"pt\"),\n    con.type = \"straight\",\n    label.fill = \"transparent\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-mark-rect-modify-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-mark-circle_5d7a242227aa79636b85acd7cea05626'}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\ng +\n  ggforce::geom_mark_circle(\n    aes(label = \"Outliers?\",\n        filter = count > 40000),\n    description = \"What happened on\\nthese two days?\",\n    color = \"black\",\n    label.family = \"Asap SemiCondensed\",\n    expand = unit(8, \"pt\"),\n    con.cap = unit(0, \"pt\"),\n    label.buffer = unit(15, \"pt\"),\n    con.type = \"straight\",\n    label.fill = \"transparent\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-mark-circle-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {ggforce}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/highlight-geom-mark-hull_e8915f4fe15c2376812ac236202d114f'}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\ng +\n  ggforce::geom_mark_hull(\n    aes(label = \"Outliers?\",\n        filter = count > 40000),\n    description = \"What happened on\\nthese two days?\",\n    color = \"black\",\n    label.family = \"Asap SemiCondensed\",\n    expand = unit(8, \"pt\"),\n    con.cap = unit(0, \"pt\"),\n    label.buffer = unit(15, \"pt\"),\n    con.type = \"straight\",\n    label.fill = \"transparent\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/highlight-geom-mark-hull-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Annotations with {geomtextpath}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/geomtextpath-prep_741a0e49dbbd2b29136775ab35403279'}\n\n```{.r .cell-code  code-line-numbers=\"1,2,3,4|5,6,7,8|9|10,11,12,13,14,15|16,17,18,19\"}\nbikes |>\n  filter(year == \"2016\") |>\n  group_by(month, day_night) |> \n  summarize(count = sum(count)) |> \n  ggplot(aes(x = month, y = count, \n             color = day_night,\n             group = day_night)) +\n  geom_line(linewidth = 1) +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(\n    labels = scales::label_comma(\n      scale = 1/10^3, suffix = \"K\"\n    ),\n    limits = c(0, 850000)\n  ) +\n  scale_color_manual(\n    values = c(\"#FFA200\", \"#757BC7\"),\n    name = NULL\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/geomtextpath-prep-1.png){width=1000}\n:::\n:::\n\n\n\n## Annotations with {geomtextpath}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/geomtextpath_122a179ed099438ec7f5442d6ae94795'}\n\n```{.r .cell-code  code-line-numbers=\"8,9,10,11,12,13,14|24\"}\nbikes |>\n  filter(year == \"2016\") |>\n  group_by(month, day_night) |> \n  summarize(count = sum(count)) |> \n  ggplot(aes(x = month, y = count, \n             color = day_night,\n             group = day_night)) +\n  geomtextpath::geom_textline(\n    aes(label = day_night),\n    linewidth = 1,\n    vjust = -.5, \n    family = \"Asap SemiCondensed\",\n    fontface = \"bold\"\n  ) +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(\n    labels = scales::label_comma(\n      scale = 1/10^3, suffix = \"K\"\n    ),\n    limits = c(0, 850000)\n  ) +\n  scale_color_manual(\n    values = c(\"#FFA200\", \"#757BC7\"),\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/geomtextpath-1.png){width=1000}\n:::\n:::\n\n\n\n## Annotations with {geomtextpath}\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/geomtextpath-long_fb6f1d661fa66d0f972e7b663be1b256'}\n\n```{.r .cell-code  code-line-numbers=\"5,6,7,8,9|17\"}\nbikes |>\n  filter(year == \"2016\") |>\n  group_by(month, day_night) |> \n  summarize(count = sum(count)) |> \n  mutate(day_night = if_else(\n    day_night == \"day\", \n    \"Day period (6am-6pm)\", \n    \"Night period (6pm-6am)\"\n  )) |> \n  ggplot(aes(x = month, y = count, \n             color = day_night,\n             group = day_night)) +\n  geomtextpath::geom_textline(\n    aes(label = day_night),\n    linewidth = 1,\n    vjust = -.5, \n    hjust = .05,\n    family = \"Asap SemiCondensed\",\n    fontface = \"bold\"\n  ) +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(\n    labels = scales::label_comma(\n      scale = 1/10^3, suffix = \"K\"\n    ),\n    limits = c(0, 850000)\n  ) +\n  scale_color_manual(\n    values = c(\"#FFA200\", \"#757BC7\"),\n    guide = \"none\"\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/geomtextpath-long-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Line Chart with \\`stat_summary()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/line-stat_0a7531d8a2e79865969e0cd402b518bc'}\n\n```{.r .cell-code  code-line-numbers=\"1,2|6,7,8,9\"}\nbikes |>\n  filter(year == \"2016\") |>\n  ggplot(aes(x = month, y = count, \n             color = day_night,\n             group = day_night)) +\n  stat_summary(\n    geom = \"line\", fun = sum,\n    linewidth = 1\n  ) +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(\n    labels = scales::label_comma(\n      scale = 1/10^3, suffix = \"K\"\n    ),\n    limits = c(0, 850000)\n  ) +\n  scale_color_manual(\n    values = c(\"#FFA200\", \"#757BC7\"),\n    name = NULL\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/line-stat-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Line Chart with \\`stat_summary()\\`\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/line-stat-textpath-fail_820863be4ed69650027c0d94ddea257c'}\n\n```{.r .cell-code  code-line-numbers=\"10,11,12,13\"}\nbikes |>\n  filter(year == \"2016\") |>\n  ggplot(aes(x = month, y = count, \n             color = day_night,\n             group = day_night)) +\n  stat_summary(\n    geom = \"line\", fun = sum,\n    linewidth = 1\n  ) +\n  geomtextpath::geom_textline(\n    aes(label = day_night), \n    stat = \"summary\" # fails\n  ) +\n  coord_cartesian(expand = FALSE) +\n  scale_y_continuous(\n    labels = scales::label_comma(\n      scale = 1/10^3, suffix = \"K\"\n    ),\n    limits = c(0, 850000)\n  ) +\n  scale_color_manual(\n    values = c(\"#FFA200\", \"#757BC7\"),\n    name = NULL\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/line-stat-textpath-fail-1.png){width=1000}\n:::\n:::\n\n\n\n\n# Adding Images\n\n\n\n## Load Image\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1|2|4\"}\nurl <- \"https://www.gs.tum.de/fileadmin/_processed_/0/7/csm_UGI_Logo_frei_ba00944e1c.png\"\nimg <- magick::image_read(url)\n\nimg\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/read-img-1.png){width=24}\n:::\n:::\n\n\n\n\n## Add Background Image\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-custom_b2941928f264b9d4149ad3ab2780c789'}\n\n```{.r .cell-code  code-line-numbers=\"3,4,5,6|3|4\"}\nggplot(bikes, aes(date, temp)) +\n  annotation_custom(\n    grid::rasterGrob(\n      image = img\n    )\n  ) +\n  geom_point(color = \"#308DD1\")\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-custom-1.png){width=1000}\n:::\n:::\n\n\n## Adjust Position\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-custom-position_e1f3cb081ba4eb82972d398ba83d6279'}\n\n```{.r .cell-code  code-line-numbers=\"5,6,7,11\"}\nggplot(bikes, aes(date, temp)) +\n  annotation_custom(\n    grid::rasterGrob(\n      image = img,\n      x = .5,\n      y = .75,\n      width = .3\n    )\n  ) +\n  geom_point(color = \"#308DD1\") +\n  ylim(NA, 35)\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-custom-position-1.png){width=1000}\n:::\n:::\n\n\n\n\n## Place Image Outside\n\n\n::: {.cell output-location='column' hash='04-ggplot-annotations_cache/revealjs/annotate-custom-position-outside_b2c469868f97e09bd8c1c693adb57731'}\n\n```{.r .cell-code  code-line-numbers=\"5,6,11,12,13,14|6,11,13\"}\nggplot(bikes, aes(date, temp)) +\n  annotation_custom(\n    grid::rasterGrob(\n      image = img,\n      x = .9,\n      y = 1.2,\n      width = .3\n    )\n  ) +\n  geom_point(color = \"#308DD1\") +\n  coord_cartesian(clip = \"off\") +\n  theme(\n    plot.margin = margin(120, 10, 10, 10)\n  )\n```\n\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/annotate-custom-position-outside-1.png){width=1000}\n:::\n:::\n\n\n\n\n## <b style='color:#663399;'>Recap</b>\n\n::: recap\n::: incremental\n-   style labels such as title, axis and legend texts with **`theme()`**\n-   format data-related labels with the **`labels`** argument of `scale_*()`\n-   adjust strip text with the **`facet_*(labeller)`** functionality\n-   add data-related annotations with **`geom_text|label()`**\n-   ... and data-unrelated annotations with **`annotate()`**\n-   use **`annotation_custom(rasterGrob())`** to add images\n-   **`{ggtext}`** allows to render labels with markdown and basic html\n-   `{ggtext}` also allows to add **dynamic linebreaks** and images\n-   **`{ggrepel}`** ensures clever placement of annotations\n-   **`ggforce::geom_mark_*()`** provide a set of advanced annotations\n:::\n:::\n\n\n\n# Exercises\n\n\n\n## Exercise 1\n\n::: question\n-  **Take a look at the following visualization.**\n   -  For each group of text labels, note how one would add and modify them.\n   -  Discuss how to automate the placement of the labels in- and outside of the bars.\n:::\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-plot_f1d8cbcea55d0f5505384ce92e6114d0'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-plot-1.png){width=1500}\n:::\n:::\n\n\n\n## Exercise 2\n\n::: question\n-   {ggtext} also comes with some new geom's. Explore those and other options on the package webpage: [wilkelab.rg/ggtext](https://wilkelab.org/ggtext/).\n-   {ggforce} comes with a variety of interesting geometries and utilities. Take a look at this wonderful toolbox: [ggforce.data-imaginist.com](https://ggforce.data-imaginist.com/). Share potentially helpful features with the group.\n:::\n\n\n\n# Solution Exercise 1 {background-color=\"#e6d9f2\"}\n\n\n\n## Exercise 1\n\n::: question\n-  **Take a look at the following visualization.**\n   -  For each group of text labels, note how one would add and modify them.\n   -  Discuss how to automate the placement of the labels in- and outside of the bars.\n:::\n\n\n\n## Horizontal Bar Chart\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1|2,3,4|5|6,7,8,9|7|10|11|12,13,14,15,16\"}\np <- \n  bikes |> \n  filter(!is.na(weather_type), year == \"2015\") |> \n  summarize(n = sum(count), .by = weather_type) |> \n  ggplot(aes(x = n, y = forcats::fct_reorder(weather_type, n))) +\n  geom_col(color = \"grey20\", fill = \"beige\", width = .7) +\n  scale_x_continuous(expand = c(0, 0)) +\n  coord_cartesian(clip = \"off\") +\n  theme_minimal(base_size = 14, base_family = \"Asap SemiCondensed\") +\n  theme(\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank()\n  )\n\np\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-0_527de4d90c6fc4c8c7e4d352632415c9'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-0-1.png){width=1500}\n:::\n:::\n\n\n\n## Add Count Annotations\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-1_a031f7cc9edd42555b97caddf8c52578'}\n\n```{.r .cell-code  code-line-numbers=\"2,3,4,5,6|3|4\"}\np +\n  geom_text(\n    aes(label = n),\n    family = \"Asap SemiCondensed\"\n  )\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-1_587bbb6efccd977e9e714ac6715ce9c4'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-1-1.png){width=1500}\n:::\n:::\n\n\n\n## Add Count Annotations\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-2_31a2e3e18ca5141ca526f21e93d31624'}\n\n```{.r .cell-code  code-line-numbers=\"4,5|5\"}\np +\n  geom_text(\n    aes(label = n,\n        hjust = n > .5*10^6),\n    family = \"Asap SemiCondensed\"\n  )\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-2_ccd0634f8c143dff3c900fce921d84c5'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-2-1.png){width=1500}\n:::\n:::\n\n\n\n## Add Count Annotations\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-3_7cd53ce5e91049d705028a6b6039edd4'}\n\n```{.r .cell-code  code-line-numbers=\"4\"}\np +\n  geom_text(\n    aes(label = paste0(\"  \", sprintf(\"%2.2f\", n / 10^6), \"M  \"),\n        hjust = n > .5*10^6),\n    family = \"Asap SemiCondensed\"\n  )\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-3_1d900fe532886433ed40fc4fe023d75c'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-3-1.png){width=1500}\n:::\n:::\n\n\n\n## Polish Axes\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-4_748f9f486da3f223cee8f4efb0111476'}\n\n```{.r .cell-code  code-line-numbers=\"8,9,10,11|9|9,12,13,14|10\"}\np +\n  geom_text(\n    aes(label = paste0(\"  \", sprintf(\"%2.2f\", n / 10^6), \"M  \"),\n        hjust = n > .5*10^6),\n    family = \"Asap SemiCondensed\"\n  ) +\n  scale_x_continuous(\n    expand = c(0, 0), name = \"**Reported bike shares**, in millions\", \n    breaks = 0:4*10^6, labels = c(\"0\", paste0(1:4, \"M\"))\n  ) +\n  theme(\n    axis.title.x = ggtext::element_markdown(hjust = 0, face = \"italic\")\n  )\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-4_2ffbb0f4a6785808ca9476832828ca16'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-4-1.png){width=1500}\n:::\n:::\n\n\n\n## Polish Axes Labels\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-5_d8a75e3a5aaef52acd142c837903f884'}\n\n```{.r .cell-code  code-line-numbers=\"12,13,14|13|17\"}\np +\n  geom_text(\n    aes(label = paste0(\"  \", sprintf(\"%2.2f\", n / 10^6), \"M  \"),\n        hjust = n > .5*10^6),\n    family = \"Asap SemiCondensed\"\n  ) +\n  scale_x_continuous(\n    expand = c(0, 0), name = \"**Reported bike shares**, in millions\", \n    breaks = 0:4*10^6, labels = c(\"0\", paste0(1:4, \"M\"))\n  ) +\n  scale_y_discrete(\n    labels = stringr::str_to_sentence, name = NULL\n  ) +\n  theme(\n    axis.title.x = ggtext::element_markdown(hjust = 0, face = \"italic\"),\n    axis.text.y = element_text(color = \"black\", size = rel(1.2))\n  )\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-5_0db210385dda2304aa29c4417baa529c'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-5-1.png){width=1500}\n:::\n:::\n\n\n\n## Add Titles\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-6_74510876dc3d9784996210273fd9ea53'}\n\n```{.r .cell-code  code-line-numbers=\"15,16,17,18,19|16,23,24|17,23,25|18,26\"}\np +\n  geom_text(\n    aes(label = paste0(\"  \", sprintf(\"%2.2f\", n / 10^6), \"M  \"),\n        hjust = n > .5*10^6),\n    family = \"Asap SemiCondensed\"\n  ) +\n  scale_x_continuous(\n    expand = c(0, 0), name = \"**Reported bike shares**, in millions\", \n    breaks = 0:4*10^6, labels = c(\"0\", paste0(1:4, \"M\"))\n  ) +\n  scale_y_discrete(\n    labels = stringr::str_to_sentence, name = NULL\n  ) +\n  labs(\n    title = \"Fair weather preferred—even in London\",\n    subtitle = \"Less than 10% of TfL bikes shares have been reported on rainy, cloudy, or snowy days in 2015.\",\n    caption = \"**Data:** Transport for London / freemeteo.com\"\n  ) +\n  theme(\n    axis.title.x = ggtext::element_markdown(hjust = 0, face = \"italic\"),\n    axis.text.y = element_text(color = \"black\", size = rel(1.2)),\n    plot.title.position = \"plot\",\n    plot.title = element_text(face = \"bold\"),\n    plot.subtitle = element_text(margin = margin(b = 20)),\n    plot.caption = ggtext::element_markdown(color = \"grey40\")\n  )\n```\n:::\n\n\n--------------------------------------------------------------------------------\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-6_48e668d701f0b520187d897fe70feeaf'}\n::: {.cell-output-display}\n![](04-ggplot-annotations_files/figure-revealjs/exercise-1-labels-6-1.png){width=1500}\n:::\n:::\n\n\n\n## Full Code\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-full_38e83f5003a552dffc59432b9cb60549'}\n\n```{.r .cell-code}\nbikes |> \n  filter(!is.na(weather_type), year == \"2015\") |> \n  summarize(n = sum(count), .by = weather_type) |> \n  ggplot(aes(x = n, y = forcats::fct_reorder(weather_type, n))) +\n  geom_col(color = \"grey20\", fill = \"beige\", width = .7) +\n  geom_text(\n    aes(label = paste0(\"  \", sprintf(\"%2.2f\", n / 10^6), \"M  \"),\n        hjust = n > .5*10^6),\n    family = \"Asap SemiCondensed\"\n  ) +\n  scale_x_continuous(\n    breaks = 0:4*10^6,\n    labels = c(\"0\", paste0(1:4, \"M\")),\n    expand = c(0, 0), \n    name = \"**Reported bike shares**, in millions\"\n  ) +\n  scale_y_discrete(labels = stringr::str_to_sentence, name = NULL) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    title = \"Fair weather preferred—even in London\",\n    subtitle = \"Less than 10% of TfL bikes shares have been reported on rainy, cloudy, or snowy days in 2015.\",\n    caption = \"**Data:** Transport for London / freemeteo.com\"\n  ) +\n  theme_minimal(base_size = 14, base_family = \"Asap SemiCondensed\") +\n  theme(\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    axis.title.x = ggtext::element_markdown(hjust = 0, face = \"italic\"),\n    axis.text.y = element_text(color = \"black\", size = rel(1.2)),\n    plot.title = element_text(face = \"bold\"),\n    plot.subtitle = element_text(margin = margin(b = 20)),\n    plot.title.position = \"plot\",\n    plot.caption = ggtext::element_markdown(color = \"grey40\")\n  )\n```\n:::\n\n\n\n## Full Code with \\`stat_summary()\\`\n\n\n::: {.cell hash='04-ggplot-annotations_cache/revealjs/exercise-1-labels-full-stat_ab6e2df1998aa4ddc44feeddbcebed52'}\n\n```{.r .cell-code  code-line-numbers=\"3|3,5,6,8|3,5,6,8,9,10,11,12,13,14,16\"}\nbikes |> \n  filter(year == \"2015\") |> \n  mutate(weather_type = forcats::fct_reorder(weather_type, count, .fun = sum)) |> \n  ggplot(aes(x = count, y = weather_type)) +\n  stat_summary(\n    geom = \"bar\", fun = sum, \n    color = \"grey20\", fill = \"beige\", width = .7\n  ) +\n  stat_summary(\n    geom = \"text\", fun = sum,\n    aes(\n      label = after_stat(paste0(\"  \", sprintf(\"%2.2f\", x / 10^6), \"M  \")),\n      hjust = after_stat(x) > .5*10^6\n    ),\n    family = \"Asap SemiCondensed\"\n  ) +\n  scale_x_continuous(\n    breaks = 0:4*10^6,\n    labels = c(\"0\", paste0(1:4, \"M\")),\n    expand = c(0, 0), \n    name = \"**Reported bike shares**, in millions\"\n  ) +\n  scale_y_discrete(labels = stringr::str_to_sentence, name = NULL) +\n  coord_cartesian(clip = \"off\") +\n  labs(\n    title = \"Fair weather preferred—even in London\",\n    subtitle = \"Less than 10% of TfL bikes shares have been reported on rainy, cloudy, or snowy days in 2015.\",\n    caption = \"**Data:** Transport for London / freemeteo.com\"\n  ) +\n  theme_minimal(base_size = 14, base_family = \"Asap SemiCondensed\") +\n  theme(\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    axis.title.x = ggtext::element_markdown(hjust = 0, face = \"italic\"),\n    axis.text.y = element_text(color = \"black\", size = rel(1.2)),\n    plot.title = element_text(face = \"bold\"),\n    plot.subtitle = element_text(margin = margin(b = 20)),\n    plot.title.position = \"plot\",\n    plot.caption = ggtext::element_markdown(color = \"grey40\")\n  )\n```\n:::\n\n\n\n\n# Solution Exercise 2 {background-color=\"#e6d9f2\"}\n\n\n\n## Exercise 2\n\n::: question\n-   {ggtext} also comes with some new geom's. Explore those and other options on the package webpage: [wilkelab.rg/ggtext](https://wilkelab.org/ggtext/).\n-   {ggforce} comes with a variety of interesting geometries and utilities. Take a look at this wonderful toolbox: [ggforce.data-imaginist.com](https://ggforce.data-imaginist.com/). Share potentially helpful features with the group.\n:::\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}